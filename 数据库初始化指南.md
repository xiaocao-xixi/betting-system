# ğŸš¨ æ•°æ®åº“åˆå§‹åŒ–æŒ‡å— | Database Initialization Guide

## é—®é¢˜ç—‡çŠ¶ | Problem Symptoms

å¦‚æœæ‚¨çœ‹åˆ°ä»¥ä¸‹ä»»ä½•é”™è¯¯ï¼š
If you see any of these errors:

- `users.map is not a function`
- `Runtime TypeError`
- é¡µé¢æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ | Page shows error message
- "æ²¡æœ‰ç”¨æˆ·æ•°æ®" | "No user data"

**è¿™æ„å‘³ç€æ•°æ®åº“è¿˜æ²¡æœ‰åˆå§‹åŒ–ï¼**
**This means the database hasn't been initialized yet!**

---

## âœ… å®Œæ•´è§£å†³æ–¹æ¡ˆ | Complete Solution

### ç¬¬ 1 æ­¥ï¼šç¡®ä¿åœ¨é¡¹ç›®ç›®å½• | Step 1: Ensure in project directory

```bash
cd betting-system
# æˆ–è€…æ‚¨çš„é¡¹ç›®è·¯å¾„ | Or your project path
```

### ç¬¬ 2 æ­¥ï¼šæ£€æŸ¥ .env æ–‡ä»¶ | Step 2: Check .env file

`.env` æ–‡ä»¶åº”è¯¥å·²ç»å­˜åœ¨ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œåˆ›å»ºå®ƒï¼š
The `.env` file should already exist. If it doesn't, create it:

```bash
# Windows
copy .env.example .env

# Mac/Linux
cp .env.example .env
```

`.env` æ–‡ä»¶å†…å®¹åº”è¯¥æ˜¯ï¼š
The `.env` file should contain:

```
DATABASE_URL="file:./dev.db"
NODE_ENV="development"
```

**æ³¨æ„ | Note:** ä»æœ€æ–°ç‰ˆæœ¬å¼€å§‹ï¼Œ`.env` æ–‡ä»¶å·²é¢„é…ç½®ï¼Œé€šå¸¸ä¸éœ€è¦æ‰‹åŠ¨åˆ›å»ºã€‚
Starting from the latest version, the `.env` file is pre-configured and usually doesn't need manual creation.

### ç¬¬ 3 æ­¥ï¼šè¿è¡Œæ•°æ®åº“è¿ç§» | Step 3: Run database migration

```bash
npx prisma migrate dev --name init
```

**é¢„æœŸè¾“å‡º | Expected output:**
```
âœ” Generated Prisma Client
âœ” Database migrations applied
```

### ç¬¬ 4 æ­¥ï¼šç”Ÿæˆ Prisma å®¢æˆ·ç«¯ | Step 4: Generate Prisma client

```bash
npx prisma generate
```

**é¢„æœŸè¾“å‡º | Expected output:**
```
âœ” Generated Prisma Client
```

### ç¬¬ 5 æ­¥ï¼šå¡«å……æµ‹è¯•æ•°æ® | Step 5: Seed test data

```bash
npm run prisma:seed
```

**é¢„æœŸè¾“å‡º | Expected output:**
```
Seeding database...
Created 10 users with initial balances
âœ… Seed completed successfully!
```

è¿™å°†åˆ›å»º 10 ä¸ªæµ‹è¯•ç”¨æˆ·ï¼Œæ¯ä¸ªç”¨æˆ·æœ‰ 1000 çš„åˆå§‹ä½™é¢ã€‚
This creates 10 test users, each with an initial balance of 1000.

### ç¬¬ 6 æ­¥ï¼šé‡å¯å¼€å‘æœåŠ¡å™¨ | Step 6: Restart dev server

```bash
# åœæ­¢å½“å‰æœåŠ¡å™¨ (Ctrl+C)
# Stop current server (Ctrl+C)

# é‡æ–°å¯åŠ¨
npm run dev
```

### ç¬¬ 7 æ­¥ï¼šåˆ·æ–°æµè§ˆå™¨ | Step 7: Refresh browser

è®¿é—® `http://localhost:3000` å¹¶åˆ·æ–°é¡µé¢ã€‚

Visit `http://localhost:3000` and refresh the page.

---

## ğŸ” éªŒè¯æ•°æ®åº“ | Verify Database

### æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶æ˜¯å¦å­˜åœ¨ | Check if database file exists

```bash
# Windows
dir *.db

# Mac/Linux
ls -la *.db
```

åº”è¯¥çœ‹åˆ° `dev.db` æ–‡ä»¶ã€‚
You should see a `dev.db` file.

### æ£€æŸ¥ç”¨æˆ·æ•°æ® | Check user data

```bash
npx prisma studio
```

è¿™å°†æ‰“å¼€ Prisma Studioï¼Œæ‚¨å¯ä»¥åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹æ•°æ®åº“å†…å®¹ã€‚
This opens Prisma Studio where you can view database contents in the browser.

---

## ğŸ†˜ å¸¸è§é—®é¢˜ | Common Issues

### é—®é¢˜ 1: "prisma command not found"

**è§£å†³æ–¹æ¡ˆ | Solution:**
```bash
npm install
```

### é—®é¢˜ 2: "Environment variable not found: DATABASE_URL"

**è§£å†³æ–¹æ¡ˆ | Solution:**

ç¡®ä¿ `.env` æ–‡ä»¶å­˜åœ¨ä¸”åŒ…å«ï¼š
Make sure `.env` file exists and contains:
```
DATABASE_URL="file:./dev.db"
```

### é—®é¢˜ 3: è¿ç§»å¤±è´¥ "Migration failed"

**è§£å†³æ–¹æ¡ˆ | Solution:**

åˆ é™¤æ•°æ®åº“å¹¶é‡æ–°å¼€å§‹ï¼š
Delete database and start over:

```bash
# Windows
del dev.db
rmdir /s /q prisma\migrations

# Mac/Linux
rm -f dev.db
rm -rf prisma/migrations

# ç„¶åé‡æ–°è¿è¡Œè¿ç§» | Then run migration again
npx prisma migrate dev --name init
```

### é—®é¢˜ 4: "ç§å­è„šæœ¬å¤±è´¥" | "Seed script failed"

**è§£å†³æ–¹æ¡ˆ | Solution:**

æ£€æŸ¥æ•°æ®åº“æ˜¯å¦å·²è¿ç§»ï¼š
Check if database is migrated:

```bash
npx prisma migrate status
```

å¦‚æœæ²¡æœ‰è¿ç§»ï¼Œè¿è¡Œï¼š
If not migrated, run:

```bash
npx prisma migrate dev
```

---

## ğŸ“ å¿«é€Ÿå‘½ä»¤å‚è€ƒ | Quick Command Reference

```bash
# å®Œæ•´çš„åˆå§‹åŒ–æµç¨‹ | Complete initialization flow
npx prisma migrate dev --name init
npx prisma generate
npm run prisma:seed
npm run dev

# é‡ç½®æ•°æ®åº“ | Reset database
npx prisma migrate reset

# æŸ¥çœ‹æ•°æ®åº“ | View database
npx prisma studio

# æŸ¥çœ‹è¿ç§»çŠ¶æ€ | Check migration status
npx prisma migrate status
```

---

## ğŸ¯ ä¸€é”®è®¾ç½®è„šæœ¬ | One-Click Setup Script

ä½¿ç”¨è‡ªåŠ¨è®¾ç½®è„šæœ¬ï¼ˆæ¨èï¼‰ï¼š
Use auto-setup script (recommended):

```bash
# Windows
verify-setup.bat

# Mac/Linux
./verify-setup.sh
```

è¿™äº›è„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆæ‰€æœ‰æ­¥éª¤ï¼
These scripts automatically complete all steps!

---

## ğŸ”— ç›¸å…³æ–‡æ¡£ | Related Documentation

- [START_HERE.md](./START_HERE.md) - å¿«é€Ÿå…¥é—¨
- [DEPLOYMENT_GUIDE.md](./DEPLOYMENT_GUIDE.md) - éƒ¨ç½²æŒ‡å—
- [TROUBLESHOOTING.md](./TROUBLESHOOTING.md) - æ•…éšœæ’é™¤

---

**å®Œæˆåï¼Œæ‚¨åº”è¯¥èƒ½çœ‹åˆ°åŒ…å« 10 ä¸ªç”¨æˆ·çš„åˆ—è¡¨ï¼** âœ…

**After completion, you should see a list with 10 users!** âœ…
